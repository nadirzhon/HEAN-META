# ============================================================================
# HEAN Trading System - Environment Configuration
# ============================================================================

# ----------------------------------------------------------------------------
# API Keys
# ----------------------------------------------------------------------------

# OpenAI API Key for agent generation
OPENAI_API_KEY=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

# Optional: Anthropic API Key (alternative to OpenAI)
# ANTHROPIC_API_KEY=your-anthropic-key-here

# ----------------------------------------------------------------------------
# Bybit API Configuration
# ----------------------------------------------------------------------------

# Bybit API credentials (required for live trading)
BYBIT_API_KEY=M255jguc0lPCV0jwlb
BYBIT_API_SECRET=366TGJMQvBfB5ApgZZtiHx03NEPWmgjPBdvC

# Use Bybit testnet (true) or mainnet (false)
# WARNING: Set to false only for production with real funds!
BYBIT_TESTNET=false

# ----------------------------------------------------------------------------
# Trading Mode
# ----------------------------------------------------------------------------

# Trading mode: "paper" (simulation) or "live" (real trading)
# Default: paper (safe mode)
TRADING_MODE=live

# Live trading confirmation (must be "YES" to enable live trading)
# WARNING: Live trading sends real orders to exchange!
LIVE_CONFIRM=YES

# ----------------------------------------------------------------------------
# Capital Management
# ----------------------------------------------------------------------------

# Initial capital in USDT
INITIAL_CAPITAL=400.0

# Cash reserve rate (not allocated, 0.0-1.0)
CASH_RESERVE_RATE=0.2

# Profit reinvestment rate (legacy, 0.0-1.0)
REINVEST_RATE=0.5

# Smart reinvestment base rate (0.0-1.0, default 0.85 = 85%)
SMART_REINVEST_BASE_RATE=0.85

# Minimum reserve percentage to always maintain (0.0-1.0, default 0.10 = 10%)
SMART_REINVEST_MIN_RESERVE_PCT=0.10

# Drawdown threshold for reducing reinvestment (default 15.0%)
SMART_REINVEST_DRAWDOWN_THRESHOLD=15.0

# Daily profit target in USD (minimum $100/day)
PROFIT_TARGET_DAILY_USD=100.0

# ----------------------------------------------------------------------------
# Risk Management
# ----------------------------------------------------------------------------

# Maximum daily drawdown percentage (default 15.0%)
MAX_DAILY_DRAWDOWN_PCT=15.0

# Maximum risk per trade percentage (default 2.0%)
MAX_TRADE_RISK_PCT=2.0

# Maximum number of open positions
MAX_OPEN_POSITIONS=100

# Maximum concurrent risk percentage across all positions (default 20.0%)
MAX_CONCURRENT_RISK_PCT=20.0

# Maximum leverage (default 5.0x)
MAX_LEVERAGE=5.0

# Maximum loss per strategy as % of initial capital (default 7.0%)
MAX_STRATEGY_LOSS_PCT=7.0

# Maximum loss per hour as % of initial capital (default 15.0%)
MAX_HOURLY_LOSS_PCT=15.0

# Number of consecutive losses before pause (default 5)
CONSECUTIVE_LOSSES_LIMIT=5

# Hours to pause after consecutive losses (default 1)
CONSECUTIVE_LOSSES_COOLDOWN_HOURS=1

# ----------------------------------------------------------------------------
# Deposit Protection
# ----------------------------------------------------------------------------

# Enable deposit protection (never allow equity below initial capital)
DEPOSIT_PROTECTION_ACTIVE=true

# Killswitch drawdown percentage from initial capital (default 20.0%)
KILLSWITCH_DRAWDOWN_PCT=20.0

# ----------------------------------------------------------------------------
# Capital Preservation Mode
# ----------------------------------------------------------------------------

# Drawdown % to activate capital preservation mode (default 12.0%)
CAPITAL_PRESERVATION_DRAWDOWN_THRESHOLD=12.0

# Profit factor threshold to activate capital preservation mode (default 0.9)
CAPITAL_PRESERVATION_PF_THRESHOLD=0.9

# Consecutive losses to activate capital preservation mode (default 3)
CAPITAL_PRESERVATION_CONSECUTIVE_LOSSES_THRESHOLD=3

# ----------------------------------------------------------------------------
# Smart Leverage
# ----------------------------------------------------------------------------

# Minimum edge in bps for 2x leverage (default 25.0)
MIN_EDGE_FOR_LEVERAGE_2X=25.0

# Minimum edge in bps for 3x leverage (default 35.0)
MIN_EDGE_FOR_LEVERAGE_3X=35.0

# Minimum edge in bps for 4x leverage (default 50.0)
MIN_EDGE_FOR_LEVERAGE_4X=50.0

# Minimum profit factor for leverage > 1x (default 1.2)
MIN_PF_FOR_LEVERAGE=1.2

# Max leverage when drawdown 10-15% (default 2.0)
MAX_LEVERAGE_ON_DRAWDOWN_10PCT=2.0

# ----------------------------------------------------------------------------
# Strategy Settings
# ----------------------------------------------------------------------------

# Enable funding harvester strategy
FUNDING_HARVESTER_ENABLED=true

# Enable basis arbitrage strategy
BASIS_ARBITRAGE_ENABLED=true

# Enable impulse engine strategy
IMPULSE_ENGINE_ENABLED=true

# ----------------------------------------------------------------------------
# Impulse Engine Specific
# ----------------------------------------------------------------------------

# Maximum attempts per day for impulse engine (default 120)
IMPULSE_MAX_ATTEMPTS_PER_DAY=120

# Cooldown period after losses (default 3)
IMPULSE_COOLDOWN_AFTER_LOSSES=3

# Cooldown minutes between trades (default 2)
IMPULSE_COOLDOWN_MINUTES=2

# Maximum spread in basis points for impulse engine (default 12)
IMPULSE_MAX_SPREAD_BPS=12

# Maximum volatility spike threshold (default 0.02)
IMPULSE_MAX_VOLATILITY_SPIKE=0.02

# Maximum time in trade in seconds (default 300)
IMPULSE_MAX_TIME_IN_TRADE_SEC=300

# Minimum maker edge in basis points (default 3.0)
IMPULSE_MAKER_EDGE_THRESHOLD_BPS=3.0

# Allowed trading hours in UTC (comma-separated ranges)
# Format: "HH:MM-HH:MM,HH:MM-HH:MM"
IMPULSE_ALLOWED_HOURS=["07:00-11:00","12:00-16:00","17:00-21:00"]

# Required volatility expansion ratio (default 1.03)
IMPULSE_VOL_EXPANSION_RATIO=1.03

# Allow impulse engine to trade in NORMAL regime
IMPULSE_ALLOW_NORMAL=true

# Size multiplier for impulse trades in NORMAL regime (default 0.5)
IMPULSE_NORMAL_SIZE_MULTIPLIER=0.5

# Percentile of recent volatility above which trades are hard-blocked (default 99.0)
VOLATILITY_HARD_BLOCK_PERCENTILE=99.0

# ----------------------------------------------------------------------------
# Execution Policy
# ----------------------------------------------------------------------------

# Use maker-first execution (post-only limit orders) - ALWAYS TRUE!
MAKER_FIRST=true

# Time-to-live for maker orders in milliseconds (default 8000)
MAKER_TTL_MS=8000

# Allow taker fallback if maker order expires and edge is still positive
ALLOW_TAKER_FALLBACK=true

# Price offset in basis points for maker orders (default 1)
MAKER_PRICE_OFFSET_BPS=1

# Tolerance in bps for maker order fills (default 0.5)
MAKER_FILL_TOLERANCE_BPS=0.5

# ----------------------------------------------------------------------------
# Execution Edge Estimator
# ----------------------------------------------------------------------------

# Minimum edge in bps for NORMAL regime (default 5.0)
MIN_EDGE_BPS_NORMAL=5.0

# Minimum edge in bps for IMPULSE regime (default 8.0)
MIN_EDGE_BPS_IMPULSE=8.0

# Minimum edge in bps for RANGE regime (default 3.0)
MIN_EDGE_BPS_RANGE=3.0

# ----------------------------------------------------------------------------
# Income Streams
# ----------------------------------------------------------------------------

# Enable funding income stream
STREAM_FUNDING_ENABLED=true

# Enable maker rebate income stream
STREAM_MAKER_REBATE_ENABLED=true

# Enable basis hedge income stream
STREAM_BASIS_ENABLED=true

# Enable volatility harvest income stream
STREAM_VOLATILITY_ENABLED=true

# Capital allocation fraction for funding income stream (default 0.1)
STREAM_FUNDING_CAPITAL_PCT=0.1

# Capital allocation fraction for maker rebate income stream (default 0.05)
STREAM_MAKER_REBATE_CAPITAL_PCT=0.05

# Capital allocation fraction for basis hedge income stream (default 0.15)
STREAM_BASIS_CAPITAL_PCT=0.15

# Capital allocation fraction for volatility harvest income stream (default 0.1)
STREAM_VOLATILITY_CAPITAL_PCT=0.1

# Maximum concurrent positions for funding income stream (default 2)
STREAM_FUNDING_MAX_POSITIONS=2

# Maximum concurrent positions for maker rebate income stream (default 10)
STREAM_MAKER_REBATE_MAX_POSITIONS=10

# Maximum concurrent positions for basis hedge income stream (default 4)
STREAM_BASIS_MAX_POSITIONS=4

# Maximum concurrent positions for volatility harvest income stream (default 3)
STREAM_VOLATILITY_MAX_POSITIONS=3

# ----------------------------------------------------------------------------
# Strategy / Decision Memory
# ----------------------------------------------------------------------------

# Number of trades to look back for rolling profit factor in memory layers (default 30)
MEMORY_WINDOW_TRADES=30

# Duration in days to blacklist a regime after repeated losses (default 7)
REGIME_BLACKLIST_DURATION_DAYS=7

# Strategy-level drawdown threshold percentage to trigger cooldown (default 15.0%)
DRAWDOWN_THRESHOLD_PCT=15.0

# Profit factor threshold below which penalties apply (default 1.0)
PF_PENALTY_THRESHOLD=1.0

# Consecutive losses in a context before temporarily blocking it (default 3)
MEMORY_LOSS_STREAK=3

# Number of hours to block a bad context after loss streak/drawdown (default 24)
MEMORY_BLOCK_HOURS=24

# Context-level drawdown threshold percentage to trigger cooldown block (default 12.0%)
MEMORY_DRAWDOWN_THRESHOLD_PCT=12.0

# ----------------------------------------------------------------------------
# Process Factory (Experimental)
# ----------------------------------------------------------------------------

# Enable Process Factory extension layer (experimental, disabled by default)
PROCESS_FACTORY_ENABLED=false

# Allow Bybit actions from Process Factory (disabled by default)
PROCESS_FACTORY_ALLOW_ACTIONS=false

# ----------------------------------------------------------------------------
# Observability
# ----------------------------------------------------------------------------

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Health check port (default 8080)
HEALTH_CHECK_PORT=8081

# Enable debug mode (bypasses safety checks, verbose logging)
# WARNING: Only for development!
DEBUG_MODE=false

# ----------------------------------------------------------------------------
# Backtest Settings
# ----------------------------------------------------------------------------

# Initial capital for backtesting (default 10000.0)
BACKTEST_INITIAL_CAPITAL=10000.0

# Maker fee for backtesting (default 0.00005 = 0.5 bps)
BACKTEST_MAKER_FEE=0.00005

# Taker fee for backtesting (default 0.0003 = 3 bps)
BACKTEST_TAKER_FEE=0.0003
