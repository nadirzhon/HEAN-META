# HEAN ‚Äî –ü–û–®–ê–ì–û–í–û–ï –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï –î–õ–Ø AI-–†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–∞–∫ –ü–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≠—Ç–∏–º –î–æ–∫—É–º–µ–Ω—Ç–æ–º

> **–≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî –ø–æ–ª–Ω–æ–µ –¢–ó –¥–ª—è Claude (–∏–ª–∏ –ª—é–±–æ–≥–æ AI-–∫–æ–¥–µ—Ä–∞).**
> –¢—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –Ω–æ–≤—ã–π —á–∞—Ç —Å Claude, –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—à—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏ –≥–æ–≤–æ—Ä–∏—à—å:
> *¬´–ü—Ä–æ—á–∏—Ç–∞–π —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç. –ù–∞—á–Ω–∏ —Å –§–∞–∑—ã 1, –®–∞–≥ 1. –ù–∞–ø–∏—à–∏ –≤–µ—Å—å –∫–æ–¥. –î–∞–π –º–Ω–µ —Ñ–∞–π–ª—ã.¬ª*
> Claude –ø—Ä–æ—á–∏—Ç–∞–µ—Ç –∏ –Ω–∞–ø–∏—à–µ—Ç —Ä–∞–±–æ—á–∏–π –∫–æ–¥. –¢—ã –∫–æ–ø–∏—Ä—É–µ—à—å —Ñ–∞–π–ª—ã –∫ —Å–µ–±–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å.
> –ö–æ–≥–¥–∞ –§–∞–∑–∞ 1 —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å—Å—è –∏ –≥–æ–≤–æ—Ä–∏—à—å: *¬´–§–∞–∑–∞ 2.¬ª*

---

# –û–ë–©–ò–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø AI-–†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê

–ü—Ä–æ—á–∏—Ç–∞–π –∏ –∑–∞–ø–æ–º–Ω–∏ –ø–µ—Ä–µ–¥ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º –ª—é–±–æ–≥–æ –∫–æ–¥–∞:

```
–Ø–ó–´–ö –ë–≠–ö–ï–ù–î–ê: Python 3.12+
–°–¢–ò–õ–¨: async/await –≤–µ–∑–¥–µ, –Ω–∏–∫–∞–∫–∏—Ö sync –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤
–¢–ò–ü–ò–ó–ê–¶–ò–Ø: type hints –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
–§–†–ï–ô–ú–í–û–†–ö: FastAPI + uvicorn
–î–ê–ù–ù–´–ï: Polars (–ù–ï Pandas), DuckDB (–ù–ï SQLite)
JSON: orjson (–ù–ï —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π json)
–õ–û–ì–ò–†–û–í–ê–ù–ò–ï: loguru (–ù–ï —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π logging)
–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø: pydantic Settings + .env —Ñ–∞–π–ª
–ë–ò–†–ñ–ò: ccxt async + websockets
AI: anthropic SDK –¥–ª—è Claude API
–¢–ï–°–¢–´: pytest + pytest-asyncio

–Ø–ó–´–ö –§–†–û–ù–¢–ï–ù–î–ê: Swift 6 + SwiftUI
–ú–ò–ù–ò–ú–ê–õ–¨–ù–ê–Ø iOS: 17.0
–ê–†–•–ò–¢–ï–ö–¢–£–†–ê: @Observable (–ù–ï ObservableObject)
–°–ï–¢–¨: URLSession native (–ù–ï Alamofire)
–ì–†–ê–§–ò–ö–ò: Swift Charts

–°–¢–†–£–ö–¢–£–†–ê –ü–ê–ü–û–ö:
hean/
‚îú‚îÄ‚îÄ server/          # Python –±—ç–∫–µ–Ω–¥
‚îú‚îÄ‚îÄ ios/             # Swift iOS app
‚îú‚îÄ‚îÄ data/            # DuckDB + Parquet
‚îú‚îÄ‚îÄ .env             # –°–µ–∫—Ä–µ—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

---

# –§–ê–ó–ê 1: –ì–õ–ê–ó–ê + –ú–û–ó–ì (–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö + Claude AI)

> **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–∑—ã:** –ó–∞–ø—É—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∫–æ—Ç–æ—Ä—ã–π:
> 1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Bybit WebSocket
> 2. –ü–æ–ª—É—á–∞–µ—Ç –æ—Ä–¥–µ—Ä–±—É–∫, —Å–¥–µ–ª–∫–∏, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
> 3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å—ë –≤ DuckDB
> 4. –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–Ω–∏–º–æ–∫ —Ä—ã–Ω–∫–∞ –≤ Claude API
> 5. –ü–æ–ª—É—á–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ –∏ —Ç–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
> 6. –û—Ç–¥–∞—ë—Ç –≤—Å—ë –Ω–∞ iPhone —á–µ—Ä–µ–∑ WebSocket

---

## –§–∞–∑–∞ 1, –®–∞–≥ 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `requirements.txt`:
```
# –Ø–¥—Ä–æ
fastapi>=0.115
uvicorn[standard]>=0.34
uvloop>=0.21
websockets>=14.0
pydantic>=2.10
pydantic-settings>=2.7
orjson>=3.10

# –ë–∏—Ä–∂–∏
ccxt>=4.4
pybit>=5.9

# –î–∞–Ω–Ω—ã–µ
polars>=1.20
numpy>=2.2
scipy>=1.15
duckdb>=1.2
pyarrow>=18.0

# AI
anthropic>=0.43

# –£—Ç–∏–ª–∏—Ç—ã
loguru>=0.7
httpx>=0.28
python-dotenv>=1.0
```

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env`:
```
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxx
BYBIT_API_KEY=xxxxxxxx
BYBIT_API_SECRET=xxxxxxxx
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
LOG_LEVEL=INFO
```

–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫:
```
server/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
‚îú‚îÄ‚îÄ collectors/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ bybit_ws.py      # WebSocket –∫–æ–ª–ª–µ–∫—Ç–æ—Ä Bybit
‚îÇ   ‚îî‚îÄ‚îÄ models.py        # Pydantic –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂
‚îú‚îÄ‚îÄ brain/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ claude_client.py # –ö–ª–∏–µ–Ω—Ç Claude API
‚îÇ   ‚îú‚îÄ‚îÄ snapshot.py      # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–Ω–∏–º–∫–∞ —Ä—ã–Ω–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ models.py        # Pydantic –º–æ–¥–µ–ª–∏ –∞–Ω–∞–ª–∏–∑–∞
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ database.py      # DuckDB –º–µ–Ω–µ–¥–∂–µ—Ä
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ws_handler.py    # WebSocket –¥–ª—è iPhone
‚îÇ   ‚îî‚îÄ‚îÄ routes.py        # REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ helpers.py
```

---

## –§–∞–∑–∞ 1, –®–∞–≥ 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/config.py` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ .env.

**–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å:**
- –ó–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —á–µ—Ä–µ–∑ pydantic-settings
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ API –∫–ª—é—á–∏ –Ω–µ –ø—É—Å—Ç—ã–µ
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å typed access –∫–æ –≤—Å–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º

**–ú–æ–¥–µ–ª—å:**
```python
class Settings(BaseSettings):
    # Anthropic
    anthropic_api_key: str
    
    # Bybit
    bybit_api_key: str = ""
    bybit_api_secret: str = ""
    
    # Server
    server_host: str = "0.0.0.0"
    server_port: int = 8000
    log_level: str = "INFO"
    
    # Trading
    symbol: str = "BTCUSDT"
    orderbook_depth: int = 50
    snapshot_interval_sec: int = 30
    
    # Paths
    db_path: str = "data/hean.db"
    
    model_config = SettingsConfigDict(env_file=".env")
```

–°–æ–∑–¥–∞–π —Å–∏–Ω–≥–ª—Ç–æ–Ω `settings = Settings()` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ –ª—é–±–æ–≥–æ –º–æ–¥—É–ª—è.

---

## –§–∞–∑–∞ 1, –®–∞–≥ 3: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/collectors/models.py` ‚Äî Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂.

**–ù—É–∂–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–æ–¥–µ–ª–∏:**

```python
class OrderBookLevel(BaseModel):
    price: float
    size: float

class OrderBookSnapshot(BaseModel):
    timestamp: datetime
    symbol: str
    bids: list[OrderBookLevel]  # –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ü–µ–Ω–µ DESC
    asks: list[OrderBookLevel]  # –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ü–µ–Ω–µ ASC
    
    @computed_field
    @property
    def mid_price(self) -> float:
        """–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –º–µ–∂–¥—É –ª—É—á—à–∏–º bid –∏ ask"""
        
    @computed_field
    @property
    def spread(self) -> float:
        """–°–ø—Ä–µ–¥ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö"""
        
    @computed_field
    @property    
    def bid_total(self) -> float:
        """–°—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä—ë–º –±–∏–¥–æ–≤"""
        
    @computed_field
    @property
    def ask_total(self) -> float:
        """–°—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä—ë–º –∞—Å–∫–æ–≤"""
        
    @computed_field
    @property
    def imbalance(self) -> float:
        """(bid_total - ask_total) / (bid_total + ask_total). 
        –î–∏–∞–ø–∞–∑–æ–Ω [-1, 1]. –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π = –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ –¥–æ–º–∏–Ω–∏—Ä—É—é—Ç."""

class Trade(BaseModel):
    timestamp: datetime
    symbol: str
    price: float
    size: float
    side: Literal["Buy", "Sell"]
    
class Liquidation(BaseModel):
    timestamp: datetime
    symbol: str
    side: Literal["Buy", "Sell"]
    price: float
    size: float

class MarketState(BaseModel):
    """–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 100–º—Å."""
    timestamp: datetime
    symbol: str
    price: float
    orderbook: OrderBookSnapshot
    recent_trades: list[Trade]       # –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å–¥–µ–ª–æ–∫
    recent_liquidations: list[Liquidation]  # –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
    
    # –ê–≥—Ä–µ–≥–∞—Ç—ã (–≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤—ã—à–µ)
    delta_1m: float = 0.0    # Buy volume - Sell volume –∑–∞ 1 –º–∏–Ω
    delta_5m: float = 0.0    # Buy volume - Sell volume –∑–∞ 5 –º–∏–Ω
    volume_1m: float = 0.0   # –û–±—â–∏–π –æ–±—ä—ë–º –∑–∞ 1 –º–∏–Ω
    big_trades_count: int = 0 # –°–¥–µ–ª–∫–∏ > 1 BTC –∑–∞ 5 –º–∏–Ω
```

**–¢–∞–∫–∂–µ** —Ñ–∞–π–ª `server/brain/models.py`:

```python
class Force(BaseModel):
    name: str           # "gravitational_pull", "institutional_flow", etc.
    direction: str      # "UP", "DOWN", "NEUTRAL"
    strength: float     # 0.0 - 1.0
    description: str

class TradingSignal(BaseModel):
    timestamp: datetime
    direction: Literal["LONG", "SHORT", "NO_TRADE"]
    confidence: float           # 0.0 - 1.0
    entry_price: float | None = None
    stop_loss: float | None = None
    take_profit_1: float | None = None
    take_profit_2: float | None = None
    risk_reward: float | None = None
    reasoning: str              # –ü–æ—á–µ–º—É AI –ø—Ä–∏–Ω—è–ª —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ

class BrainAnalysis(BaseModel):
    timestamp: datetime
    situation: str              # –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º —è–∑—ã–∫–æ–º
    forces: list[Force]         # –°–∏–ª—ã –¥–µ–π—Å—Ç–≤—É—é—â–∏–µ –Ω–∞ —Ä—ã–Ω–æ–∫
    signal: TradingSignal
    market_phase: Literal["ice", "ice_to_water", "water", "water_to_steam", "steam"]
    danger_level: float         # 0.0 - 1.0
```

---

## –§–∞–∑–∞ 1, –®–∞–≥ 4: Bybit WebSocket –ö–æ–ª–ª–µ–∫—Ç–æ—Ä

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/collectors/bybit_ws.py` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Bybit –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

**–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å:**
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `wss://stream.bybit.com/v5/public/linear`
2. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ 3 —Ç–æ–ø–∏–∫–∞:
   - `orderbook.50.BTCUSDT` ‚Äî –æ—Ä–¥–µ—Ä–±—É–∫ 50 —É—Ä–æ–≤–Ω–µ–π
   - `publicTrade.BTCUSDT` ‚Äî –≤—Å–µ —Å–¥–µ–ª–∫–∏
   - `liquidation.BTCUSDT` ‚Äî –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (ping/pong –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥)
4. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø–∞—Ä—Å–∏—Ç—å –≤ Pydantic –º–æ–¥–µ–ª–∏ –∏ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å
5. –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
6. –í–µ—Å—Ç–∏ –ª–æ–≥: —Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—É—á–µ–Ω–æ, —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞

**–§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∫–∏ Bybit v5:**
```json
{"op": "subscribe", "args": ["orderbook.50.BTCUSDT", "publicTrade.BTCUSDT", "liquidation.BTCUSDT"]}
```

**–§–æ—Ä–º–∞—Ç –æ—Ä–¥–µ—Ä–±—É–∫–∞ Bybit v5:**
```json
{
    "topic": "orderbook.50.BTCUSDT",
    "type": "snapshot",  // –∏–ª–∏ "delta"
    "data": {
        "s": "BTCUSDT",
        "b": [["94247.50", "2.345"], ...],  // bids: [price, size]
        "a": [["94248.00", "1.123"], ...],  // asks: [price, size]
        "u": 1234567  // update id
    },
    "ts": 1707312000000  // timestamp ms
}
```

**–í–ê–ñ–ù–û:** Bybit —à–ª—ë—Ç –ø–µ—Ä–≤—ã–π —Å–Ω–∏–º–æ–∫ –∫–∞–∫ `"type": "snapshot"`, –ø–æ—Ç–æ–º –¥–µ–ª—å—Ç—ã `"type": "delta"`. –ù—É–∂–Ω–æ:
- –ü—Ä–∏ snapshot ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –≤–µ—Å—å –æ—Ä–¥–µ—Ä–±—É–∫
- –ü—Ä–∏ delta ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ (size=0 –∑–Ω–∞—á–∏—Ç —É–¥–∞–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å)

**–§–æ—Ä–º–∞—Ç —Å–¥–µ–ª–æ–∫ Bybit v5:**
```json
{
    "topic": "publicTrade.BTCUSDT",
    "data": [
        {
            "s": "BTCUSDT",
            "S": "Buy",      // Buy –∏–ª–∏ Sell
            "v": "0.123",    // volume
            "p": "94247.50", // price
            "T": 1707312000000  // timestamp ms
        }
    ]
}
```

**–§–æ—Ä–º–∞—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π Bybit v5:**
```json
{
    "topic": "liquidation.BTCUSDT",
    "data": {
        "symbol": "BTCUSDT",
        "side": "Sell",
        "price": "93200.00",
        "size": "0.567",
        "updatedTime": 1707312000000
    }
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞:**
```python
class BybitCollector:
    def __init__(self, symbol: str = "BTCUSDT"):
        self.symbol = symbol
        self.orderbook: OrderBookSnapshot | None = None
        self.trades: deque[Trade] = deque(maxlen=1000)
        self.liquidations: deque[Liquidation] = deque(maxlen=500)
        self._ws = None
        self._running = False
        
    async def start(self):
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"""
        
    async def _connect(self):
        """–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è"""
        
    async def _listen(self):
        """–°–ª—É—à–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–∞—Ä—Å–∏—Ç—å, –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ"""
        
    async def _handle_orderbook(self, data: dict, msg_type: str):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å snapshot –∏–ª–∏ delta –æ—Ä–¥–µ—Ä–±—É–∫–∞"""
        
    async def _handle_trade(self, data: list[dict]):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–¥–µ–ª–∫–∏"""
        
    async def _handle_liquidation(self, data: dict):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ª–∏–∫–≤–∏–¥–∞—Ü–∏—é"""
        
    def get_market_state(self) -> MarketState:
        """–í–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—É—â–µ–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞.
        –í—ã—á–∏—Å–ª–∏—Ç—å delta_1m, delta_5m, volume_1m, big_trades_count
        –∏–∑ self.trades –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1 –∏ 5 –º–∏–Ω—É—Ç."""
        
    async def _ping_loop(self):
        """–ö–∞–∂–¥—ã–µ 20 —Å–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å ping –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
```

---

## –§–∞–∑–∞ 1, –®–∞–≥ 5: DuckDB —Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/storage/database.py` ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å:**
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
2. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ä–¥–µ—Ä–±—É–∫-—Å–Ω–∏–º–∫–∏ (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥, –Ω–µ –∫–∞–∂–¥—ã–µ 100–º—Å ‚Äî –∏–Ω–∞—á–µ –ë–î —Ä–∞–∑–¥—É–µ—Ç—Å—è)
3. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Å–µ —Å–¥–µ–ª–∫–∏
4. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
5. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∞–Ω–∞–ª–∏–∑—ã –º–æ–∑–≥–∞ (BrainAnalysis)
6. –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
7. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–¢–∞–±–ª–∏—Ü—ã:**

```sql
CREATE TABLE IF NOT EXISTS orderbook_snapshots (
    timestamp TIMESTAMP,
    symbol VARCHAR,
    mid_price DOUBLE,
    spread DOUBLE,
    bid_total DOUBLE,
    ask_total DOUBLE,
    imbalance DOUBLE,
    top_bid_price DOUBLE,
    top_ask_price DOUBLE,
    top_bid_size DOUBLE,
    top_ask_size DOUBLE
);

CREATE TABLE IF NOT EXISTS trades (
    timestamp TIMESTAMP,
    symbol VARCHAR,
    price DOUBLE,
    size DOUBLE,
    side VARCHAR
);

CREATE TABLE IF NOT EXISTS liquidations (
    timestamp TIMESTAMP,
    symbol VARCHAR,
    side VARCHAR,
    price DOUBLE,
    size DOUBLE
);

CREATE TABLE IF NOT EXISTS brain_analyses (
    timestamp TIMESTAMP,
    situation TEXT,
    market_phase VARCHAR,
    danger_level DOUBLE,
    signal_direction VARCHAR,
    signal_confidence DOUBLE,
    signal_entry DOUBLE,
    signal_stop DOUBLE,
    signal_tp1 DOUBLE,
    signal_tp2 DOUBLE,
    signal_rr DOUBLE,
    reasoning TEXT
);
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞:**
```python
class Database:
    def __init__(self, db_path: str):
        self.db_path = db_path
        self.conn = None
        
    async def initialize(self):
        """–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è, —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã"""
        
    def save_orderbook(self, snapshot: OrderBookSnapshot):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–Ω–∏–º–æ–∫ –æ—Ä–¥–µ—Ä–±—É–∫–∞"""
        
    def save_trade(self, trade: Trade):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–¥–µ–ª–∫—É"""
        
    def save_trades_batch(self, trades: list[Trade]):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—á–∫—É —Å–¥–µ–ª–æ–∫ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ)"""
        
    def save_liquidation(self, liq: Liquidation):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–∏–∫–≤–∏–¥–∞—Ü–∏—é"""
        
    def save_analysis(self, analysis: BrainAnalysis):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –º–æ–∑–≥–∞"""
        
    def get_recent_trades(self, minutes: int = 5) -> list[dict]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–¥–µ–ª–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –º–∏–Ω—É—Ç"""
        
    def get_liquidations_today(self) -> list[dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è"""
        
    def get_stats(self) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: –∫–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ"""
```

**–í–ê–ñ–ù–û:** DuckDB –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç async. –ò—Å–ø–æ–ª—å–∑—É–π `asyncio.to_thread()` –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ –∏–∑ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π DuckDB –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ.

---

## –§–∞–∑–∞ 1, –®–∞–≥ 6: Claude Brain (–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ú–æ–∑–≥)

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/brain/claude_client.py` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞ —á–µ—Ä–µ–∑ Claude.

**–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å:**
1. –ü—Ä–∏–Ω–∏–º–∞—Ç—å MarketState
2. –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ —Ä—ã–Ω–∫–∞
3. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ Claude API
4. –ü–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ BrainAnalysis
5. –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Claude (–í–°–¢–ê–í–ò–¢–¨ –î–û–°–õ–û–í–ù–û):**

```
–¢—ã ‚Äî HEAN, —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–æ—Ä–≥–æ–≤—ã–π –¥–≤–∏–∂–æ–∫. –¢—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Ä—ã–Ω–æ–∫ –∫–∞–∫ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É.

–¢–í–û–ò –ü–†–ò–ù–¶–ò–ü–´:
1. –¶–µ–Ω–∞ ‚Äî —Å–ª–µ–¥—Å—Ç–≤–∏–µ. –¢—ã —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –ü–†–ò–ß–ò–ù–´: –æ—Ä–¥–µ—Ä—Ñ–ª–æ—É, –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –ø–æ–≤–µ–¥–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
2. –¢—ã –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—à—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: –º–∞—Ä–∫–µ—Ç–º–µ–π–∫–µ—Ä, –∏–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª, —Ä–∏—Ç–µ–π–ª, –±–æ—Ç, –∫–∏—Ç.
3. –¢—ã –∏–∑–º–µ—Ä—è–µ—à—å "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É" (–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å/–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å) –∏ "—ç–Ω—Ç—Ä–æ–ø–∏—é" (—Ö–∞–æ—Å/–ø–æ—Ä—è–¥–æ–∫).
4. –¢—ã —Ç–æ—Ä–≥—É–µ—à—å –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ —Ñ–∏–∑–∏–∫–∞ —Ä—ã–Ω–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è. –ò–Ω–∞—á–µ ‚Äî NO_TRADE.
5. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π R:R = 1:2. –ï—Å–ª–∏ –Ω–µ –≤–∏–¥–∏—à—å ‚Äî –Ω–µ —Ç–æ—Ä–≥—É–π.

–ü–†–ê–í–ò–õ–ê –ê–ù–ê–õ–ò–ó–ê:
- –î–∏—Å–±–∞–ª–∞–Ω—Å –æ—Ä–¥–µ—Ä–±—É–∫–∞ > 0.3 = —Å–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
- –î–µ–ª—å—Ç–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏ —Ä–æ—Å—Ç–µ = –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è (–º–µ–¥–≤–µ–∂–∏–π —Å–∏–≥–Ω–∞–ª)
- –ö—Ä—É–ø–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (>1 BTC) = –∏–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –°–∫–æ–ø–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π = –º–∞–≥–Ω–∏—Ç –¥–ª—è —Ü–µ–Ω—ã
- Funding rate > 0.05% = –ø–µ—Ä–µ–≥—Ä–µ–≤ –ª–æ–Ω–≥–æ–≤
- Long/Short ratio > 70/30 = –æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω—ã

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê ‚Äî –¢–û–õ–¨–ö–û JSON, –±–µ–∑ markdown:
{
  "situation": "–æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –Ω–∞ —Ä—ã–Ω–∫–µ",
  "forces": [
    {"name": "–∏–º—è_—Å–∏–ª—ã", "direction": "UP/DOWN/NEUTRAL", "strength": 0.0-1.0, "description": "–æ–ø–∏—Å–∞–Ω–∏–µ"}
  ],
  "signal": {
    "direction": "LONG/SHORT/NO_TRADE",
    "confidence": 0.0-1.0,
    "entry_price": —á–∏—Å–ª–æ –∏–ª–∏ null,
    "stop_loss": —á–∏—Å–ª–æ –∏–ª–∏ null,
    "take_profit_1": —á–∏—Å–ª–æ –∏–ª–∏ null,
    "take_profit_2": —á–∏—Å–ª–æ –∏–ª–∏ null,
    "risk_reward": —á–∏—Å–ª–æ –∏–ª–∏ null,
    "reasoning": "–ø–æ—á–µ–º—É –ø—Ä–∏–Ω—è–ª —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ"
  },
  "market_phase": "ice/ice_to_water/water/water_to_steam/steam",
  "danger_level": 0.0-1.0
}
```

**–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞** (—Ñ–∞–π–ª `server/brain/snapshot.py`):

```python
def format_market_snapshot(state: MarketState) -> str:
    """–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç MarketState –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–Ω–∏–º–æ–∫ –¥–ª—è Claude.
    
    –§–æ—Ä–º–∞—Ç:
    === –°–ù–ò–ú–û–ö –†–´–ù–ö–ê {symbol} ===
    –í—Ä–µ–º—è: {timestamp}
    –¶–µ–Ω–∞: {price}
    
    –û–†–î–ï–†–ë–£–ö:
    - –°–ø—Ä–µ–¥: {spread}%
    - –î–∏—Å–±–∞–ª–∞–Ω—Å: {imbalance} (>0 = –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏, <0 = –ø—Ä–æ–¥–∞–≤—Ü—ã)
    - –°—É–º–º–∞—Ä–Ω—ã–π bid: {bid_total} BTC
    - –°—É–º–º–∞—Ä–Ω—ã–π ask: {ask_total} BTC
    - –ö—Ä—É–ø–Ω–µ–π—à–∞—è —Å—Ç–µ–Ω–∞ bid: {price} @ {size} BTC
    - –ö—Ä—É–ø–Ω–µ–π—à–∞—è —Å—Ç–µ–Ω–∞ ask: {price} @ {size} BTC
    
    –û–†–î–ï–†–§–õ–û–£ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç):
    - –î–µ–ª—å—Ç–∞ 1–º–∏–Ω: {delta_1m} BTC (>0 = –ø–æ–∫—É–ø–∫–∏, <0 = –ø—Ä–æ–¥–∞–∂–∏)
    - –î–µ–ª—å—Ç–∞ 5–º–∏–Ω: {delta_5m} BTC
    - –û–±—ä—ë–º 1–º–∏–Ω: {volume_1m} BTC
    - –ö—Ä—É–ø–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ (>1 BTC): {big_trades_count}
    - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∫—Ä—É–ø–Ω—ã—Ö: {–æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π}
    
    –õ–ò–ö–í–ò–î–ê–¶–ò–ò (–∑–∞ —á–∞—Å):
    - Long –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏: {total} BTC –Ω–∞ —Å—É–º–º—É ${total_usd}
    - Short –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏: {total} BTC –Ω–∞ —Å—É–º–º—É ${total_usd}
    
    –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û:
    - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∞–Ω–∞–ª–∏–∑–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å): –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ—à–µ–Ω–∏–π
    """
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Claude –∫–ª–∏–µ–Ω—Ç–∞:**
```python
class HEANBrain:
    def __init__(self, api_key: str):
        self.client = anthropic.AsyncAnthropic(api_key=api_key)
        self.model = "claude-sonnet-4-20250514"
        self.system_prompt = "..."  # —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤—ã—à–µ
        self.history: deque[BrainAnalysis] = deque(maxlen=100)
        
    async def analyze(self, state: MarketState) -> BrainAnalysis:
        """
        1. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–∏–º–æ–∫ —á–µ—Ä–µ–∑ format_market_snapshot(state)
        2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Claude API —Å system_prompt
        3. –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç
        4. –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –≤ BrainAnalysis
        5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ self.history
        6. –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        
        –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å 1 —Ä–∞–∑.
        –ü—Ä–∏ –æ—à–∏–±–∫–µ API ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å NO_TRADE —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º.
        """
        
    def get_last_analyses(self, n: int = 3) -> list[BrainAnalysis]:
        """–ü–æ—Å–ª–µ–¥–Ω–∏–µ N –∞–Ω–∞–ª–∏–∑–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
```

**–í–ê–ñ–ù–û:** 
- –ò—Å–ø–æ–ª—å–∑—É–π `anthropic.AsyncAnthropic` (async –≤–µ—Ä—Å–∏—é)
- –ú–æ–¥–µ–ª—å: `claude-sonnet-4-20250514` (–±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞)
- `max_tokens=2000`
- `temperature=0.3` (–Ω—É–∂–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
- –ü–∞—Ä—Å–∏ JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞: Claude –º–æ–∂–µ—Ç –æ–±–µ—Ä–Ω—É—Ç—å –≤ ```json```, –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å—Ç–∏—Ç—å

---

## –§–∞–∑–∞ 1, –®–∞–≥ 7: WebSocket –¥–ª—è iPhone

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/api/ws_handler.py` ‚Äî WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ iPhone.

**–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å:**
1. –ü—Ä–∏–Ω–∏–º–∞—Ç—å WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ `/ws`
2. –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
3. –ö–∞–∂–¥—ã–µ 500–º—Å ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ MarketState
4. –ü—Ä–∏ –Ω–æ–≤–æ–º –∞–Ω–∞–ª–∏–∑–µ –º–æ–∑–≥–∞ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å BrainAnalysis
5. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
6. –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî —á–∏—Å—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —Å–µ—Ä–≤–µ—Ä ‚Üí –∫–ª–∏–µ–Ω—Ç:**

```json
{
    "type": "market_update",
    "data": {
        "price": 94247.50,
        "spread": 0.01,
        "imbalance": -0.23,
        "delta_1m": -1.45,
        "delta_5m": -4.82,
        "volume_1m": 12.34,
        "big_trades_count": 7,
        "bid_total": 124.5,
        "ask_total": 167.2
    }
}
```

```json
{
    "type": "brain_analysis",
    "data": {
        "situation": "...",
        "forces": [...],
        "signal": {...},
        "market_phase": "ice_to_water",
        "danger_level": 0.45
    }
}
```

```json
{
    "type": "system_status",
    "data": {
        "uptime_seconds": 3600,
        "ws_connected": true,
        "last_analysis": "2025-02-07T14:32:10Z",
        "trades_collected": 45230,
        "db_size_mb": 128.5
    }
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```python
class ConnectionManager:
    def __init__(self):
        self.active_connections: list[WebSocket] = []
        
    async def connect(self, websocket: WebSocket):
        await websocket.accept()
        self.active_connections.append(websocket)
        
    def disconnect(self, websocket: WebSocket):
        self.active_connections.remove(websocket)
        
    async def broadcast(self, message: dict):
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º.
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å orjson –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
        –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞."""
```

---

## –§–∞–∑–∞ 1, –®–∞–≥ 8: REST API

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/api/routes.py` ‚Äî REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

```
GET /api/status
  ‚Üí –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: uptime, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∏—Ä–∂–µ, –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–Ω–∞–ª–∏–∑, –∫–æ–ª-–≤–æ –¥–∞–Ω–Ω—ã—Ö

GET /api/market
  ‚Üí –¢–µ–∫—É—â–∏–π MarketState (–ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–Ω–∏–º–æ–∫)

GET /api/brain/latest
  ‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–π BrainAnalysis

GET /api/brain/history?limit=20
  ‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–µ N –∞–Ω–∞–ª–∏–∑–æ–≤

GET /api/trades/recent?minutes=5
  ‚Üí –ù–µ–¥–∞–≤–Ω–∏–µ —Å–¥–µ–ª–∫–∏

GET /api/liquidations/today
  ‚Üí –õ–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è

GET /api/stats
  ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î: –∫–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π, —Ä–∞–∑–º–µ—Ä, uptime
```

–í—Å–µ –æ—Ç–≤–µ—Ç—ã ‚Äî —á–µ—Ä–µ–∑ `ORJSONResponse` (–±—ã—Å—Ç—Ä–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ).

---

## –§–∞–∑–∞ 1, –®–∞–≥ 9: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è)

**–ó–∞–¥–∞—á–∞:** –§–∞–π–ª `server/main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

**–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å:**
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å DuckDB
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Bybit WebSocket –∫–æ–ª–ª–µ–∫—Ç–æ—Ä (–≤ —Ñ–æ–Ω–µ)
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å Brain –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (–∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥ –≤ —Ñ–æ–Ω–µ)
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å FastAPI —Å–µ—Ä–≤–µ—Ä —Å WebSocket –∏ REST
6. –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ (SIGINT/SIGTERM) ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –≤—Å—ë

**–õ–æ–≥–∏–∫–∞:**
```python
app = FastAPI(title="HEAN Server", version="0.1.0")

@app.on_event("startup")
async def startup():
    # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
    app.state.db = Database(settings.db_path)
    await app.state.db.initialize()
    
    # 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ç–æ—Ä
    app.state.collector = BybitCollector(settings.symbol)
    asyncio.create_task(app.state.collector.start())
    
    # 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–∑–≥
    app.state.brain = HEANBrain(settings.anthropic_api_key)
    asyncio.create_task(brain_loop(app))
    
    # 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    asyncio.create_task(db_save_loop(app))
    
    # 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ WebSocket
    asyncio.create_task(ws_broadcast_loop(app))
    
    logger.info("HEAN Server started üöÄ")

async def brain_loop(app):
    """–ö–∞–∂–¥—ã–µ snapshot_interval_sec —Å–µ–∫—É–Ω–¥:
    1. –ü–æ–ª—É—á–∏—Ç—å market_state –∏–∑ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞
    2. –ï—Å–ª–∏ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä –µ—â—ë –Ω–µ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è ‚Äî –∂–¥–∞—Ç—å
    3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ brain.analyze()
    4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î
    5. –†–∞–∑–æ—Å–ª–∞—Ç—å —á–µ—Ä–µ–∑ WebSocket
    """

async def db_save_loop(app):
    """–ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥:
    1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–Ω–∏–º–æ–∫ –æ—Ä–¥–µ—Ä–±—É–∫–∞
    2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—á–∫—É –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫
    3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
    """

async def ws_broadcast_loop(app):
    """–ö–∞–∂–¥—ã–µ 500–º—Å:
    1. –ü–æ–ª—É—á–∏—Ç—å market_state –∏–∑ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞
    2. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å market_update —Å–æ–æ–±—â–µ–Ω–∏–µ
    3. –†–∞–∑–æ—Å–ª–∞—Ç—å –≤—Å–µ–º WebSocket –∫–ª–∏–µ–Ω—Ç–∞–º
    """

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç—ã
app.include_router(api_router)

# WebSocket —ç–Ω–¥–ø–æ–∏–Ω—Ç
@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    await manager.connect(websocket)
    try:
        while True:
            # –ñ–¥—ë–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (ping/pong –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã)
            data = await websocket.receive_text()
    except WebSocketDisconnect:
        manager.disconnect(websocket)

# –ó–∞–ø—É—Å–∫
if __name__ == "__main__":
    uvicorn.run("server.main:app", host=settings.server_host, 
                port=settings.server_port, reload=False)
```

---

## –§–∞–∑–∞ 1, –®–∞–≥ 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ó–∞–¥–∞—á–∞:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–¢–µ—Å—Ç 1: –ó–∞–ø—É—Å–∫**
```bash
cd hean/
python -m server.main
```
–û–∂–∏–¥–∞–µ–º—ã–π –ª–æ–≥:
```
INFO | HEAN Server started üöÄ
INFO | Connecting to Bybit WebSocket...
INFO | Subscribed to orderbook.50.BTCUSDT
INFO | Subscribed to publicTrade.BTCUSDT
INFO | Subscribed to liquidation.BTCUSDT
INFO | First orderbook snapshot received: mid_price=94247.50
INFO | Brain analysis #1: market_phase=ice, signal=NO_TRADE
```

**–¢–µ—Å—Ç 2: REST API**
```bash
curl http://localhost:8000/api/status
curl http://localhost:8000/api/market
curl http://localhost:8000/api/brain/latest
```

**–¢–µ—Å—Ç 3: WebSocket**
```python
# test_ws.py
import asyncio
import websockets
import json

async def test():
    async with websockets.connect("ws://localhost:8000/ws") as ws:
        for _ in range(10):
            msg = await ws.recv()
            data = json.loads(msg)
            print(f"Type: {data['type']}, Price: {data.get('data', {}).get('price', 'N/A')}")

asyncio.run(test())
```

---

# –§–ê–ó–ê 2: –§–ò–ó–ò–ö–ê (–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≠–Ω—Ç—Ä–æ–ø–∏—è, –§–∞–∑—ã)

> **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–∑—ã:** –°–µ—Ä–≤–µ—Ä –≤—ã—á–∏—Å–ª—è–µ—Ç T, S, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∞–∑—É —Ä—ã–Ω–∫–∞. 
> iPhone –≤–∏–¥–∏—Ç —Ç–µ—Ä–º–æ–º–µ—Ç—Ä –∏ —Ñ–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã.

---

## –§–∞–∑–∞ 2, –®–∞–≥ 1: –ú–æ–¥—É–ª—å —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∏

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å `server/physics/` —Å –º–æ–¥—É–ª—è–º–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

```
server/physics/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ temperature.py    # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Ä—ã–Ω–∫–∞
‚îú‚îÄ‚îÄ entropy.py        # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏
‚îú‚îÄ‚îÄ phase.py          # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–∑—ã (–ª—ë–¥/–≤–æ–¥–∞/–ø–∞—Ä)
‚îî‚îÄ‚îÄ models.py         # Pydantic –º–æ–¥–µ–ª–∏ —Ñ–∏–∑–∏–∫–∏
```

**–§–∞–π–ª `server/physics/models.py`:**
```python
class ThermodynamicState(BaseModel):
    timestamp: datetime
    temperature: float          # 0 - 2000+ (–±–µ–∑—Ä–∞–∑–º–µ—Ä–Ω–∞—è)
    entropy: float              # 0.0 - 1.0
    phase: Literal["ice", "ice_to_water", "water", "water_to_steam", "steam"]
    phase_change_probability: float  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
    energy: float               # –ö–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –æ—Ä–¥–µ—Ä–±—É–∫–∞
    pressure: float             # "–î–∞–≤–ª–µ–Ω–∏–µ" ‚Äî –¥–∏—Å–±–∞–ª–∞–Ω—Å √ó –æ–±—ä—ë–º
```

**–§–∞–π–ª `server/physics/temperature.py`:**

```python
def calculate_temperature(orderbook: OrderBookSnapshot, recent_trades: list[Trade]) -> float:
    """
    –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä—ã–Ω–∫–∞ = –º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.
    
    –§–æ—Ä–º—É–ª–∞:
    T = (KE / N) * scaling_factor
    
    –≥–¥–µ:
    KE (–∫–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è) = —Å—É–º–º–∞ –ø–æ –≤—Å–µ–º —É—Ä–æ–≤–Ω—è–º –æ—Ä–¥–µ—Ä–±—É–∫–∞:
        (–∏–∑–º–µ–Ω–µ–Ω–∏–µ_—Ü–µ–Ω—ã_—É—Ä–æ–≤–Ω—è √ó –æ–±—ä—ë–º_–Ω–∞_—É—Ä–æ–≤–Ω–µ)¬≤
        
    –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ —É—Ä–æ–≤–Ω–µ–π) –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ:
    KE = sum_i( (price_i - mid_price)¬≤ * size_i ) –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π bid –∏ ask
    
    N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–Ω—É–ª–µ–≤—ã—Ö —É—Ä–æ–≤–Ω–µ–π
    
    scaling_factor = 1000 (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏—è)
    
    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—ë–º —Å–¥–µ–ª–æ–∫:
    trade_energy = sum( price * size ) –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥
    
    T_final = alpha * KE/N + beta * trade_energy
    –≥–¥–µ alpha=0.7, beta=0.3
    
    –í–ê–ñ–ù–û: –•—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é T –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –º–∏–Ω—É—Ç –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤.
    """
```

**–§–∞–π–ª `server/physics/entropy.py`:**

```python
def calculate_entropy(orderbook: OrderBookSnapshot) -> float:
    """
    –≠–Ω—Ç—Ä–æ–ø–∏—è —Ä—ã–Ω–∫–∞ = –º–µ—Ä–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤ (—Ö–∞–æ—Å vs –ø–æ—Ä—è–¥–æ–∫).
    
    –§–æ—Ä–º—É–ª–∞ (Shannon Entropy):
    S = -sum( p_i * log2(p_i) ) / log2(N)
    
    –≥–¥–µ:
    p_i = size_i / total_size  ‚Äî –¥–æ–ª—è –æ–±—ä—ë–º–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ i
    N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π
    –î–µ–ª–∏–º –Ω–∞ log2(N) –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ [0, 1]
    
    –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:
    S ‚Üí 1.0: –æ—Ä–¥–µ—Ä–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ ‚Üí —Ä—ã–Ω–æ–∫ –≤ –±–∞–ª–∞–Ω—Å–µ, –Ω–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    S ‚Üí 0.0: –æ—Ä–¥–µ—Ä–∞ —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ 1-2 —É—Ä–æ–≤–Ω—è—Ö ‚Üí –∫—Ç–æ-—Ç–æ –Ω–∞–±–∏—Ä–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é
    
    –°—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è bid –∏ ask, –ø–æ—Ç–æ–º —Å—Ä–µ–¥–Ω–µ–µ:
    S = (S_bid + S_ask) / 2
    
    –í–ê–ñ–ù–û: 
    - –ï—Å–ª–∏ size_i == 0, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (log(0) = -inf)
    - –•—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é S –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –º–∏–Ω—É—Ç
    - –†–µ–∑–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ S (>20% –∑–∞ 5 –º–∏–Ω) = –ê–ù–û–ú–ê–õ–ò–Ø
    """
```

**–§–∞–π–ª `server/physics/phase.py`:**

```python
def detect_phase(
    temperature_history: list[float],  # T –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω (–ø–æ 1 –≤ –º–∏–Ω—É—Ç—É)
    entropy_history: list[float],      # S –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω
    current_t: float,
    current_s: float
) -> tuple[str, float]:
    """
    –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–∑—ã —Ä—ã–Ω–∫–∞ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞.
    
    –§–∞–∑—ã:
    
    ICE (–±–æ–∫–æ–≤–∏–∫, –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–π —Ä—ã–Ω–æ–∫):
        T < median(T_history) AND S > 0.6
        –ü—Ä–∏–∑–Ω–∞–∫–∏: –Ω–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –æ—Ä–¥–µ—Ä–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã, –Ω–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        
    ICE_TO_WATER (—Å–∂–∞—Ç–∏–µ –ø–µ—Ä–µ–¥ –¥–≤–∏–∂–µ–Ω–∏–µ–º):
        T < median AND S –ø–∞–¥–∞–µ—Ç (diff_5min < -0.1)
        –ü—Ä–∏–∑–Ω–∞–∫–∏: T –µ—â—ë –Ω–∏–∑–∫–∞—è, –Ω–æ S —Ä–µ–∑–∫–æ –ø–∞–¥–∞–µ—Ç ‚Üí –∫—Ç–æ-—Ç–æ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç –æ—Ä–¥–µ—Ä–∞
        –≠–¢–û –°–ê–ú–´–ô –í–ê–ñ–ù–´–ô –ú–û–ú–ï–ù–¢ ‚Äî –ø—Ä—É–∂–∏–Ω–∞ —Å–∂–∏–º–∞–µ—Ç—Å—è
        
    WATER (–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥):
        T > median AND S –≤ —Å—Ä–µ–¥–Ω–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0.3-0.7)
        –ü—Ä–∏–∑–Ω–∞–∫–∏: –∞–∫—Ç–∏–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, –æ—Ä–¥–µ—Ä–∞ —É–º–µ—Ä–µ–Ω–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
        
    WATER_TO_STEAM (—Ä–∞–∑–≥–æ–Ω –∫ –∫–∞—Å–∫–∞–¥—É):
        T —Ä–∞—Å—Ç—ë—Ç –±—ã—Å—Ç—Ä–æ (diff_5min > +20%) AND S –ø–∞–¥–∞–µ—Ç
        –ü—Ä–∏–∑–Ω–∞–∫–∏: –¥–≤–∏–∂–µ–Ω–∏–µ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è, –æ—Ä–¥–µ—Ä–∞ –∏—Å—á–µ–∑–∞—é—Ç —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        
    STEAM (–∫–∞—Å–∫–∞–¥/–ø–∞–Ω–∏–∫–∞):
        T > 90th percentile AND (S < 0.2 OR S > 0.9)
        –ü—Ä–∏–∑–Ω–∞–∫–∏: —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ª–∏–±–æ –ø–æ–ª–Ω—ã–π —Ö–∞–æ—Å, –ª–∏–±–æ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
    
    –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞:
        –°—á–∏—Ç–∞–µ–º –∫–∞–∫ —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è S (|dS/dt|) –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –≤ [0, 1]
        –ë—ã—Å—Ç—Ä–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏ = –≤—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞
    
    Returns: (phase_name, transition_probability)
    """
```

---

## –§–∞–∑–∞ 2, –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ–∏–∑–∏–∫–∏ –≤ —Å–µ—Ä–≤–µ—Ä

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ –≤ main loop.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –í `server/main.py` –¥–æ–±–∞–≤–∏—Ç—å `PhysicsEngine`:
```python
class PhysicsEngine:
    def __init__(self):
        self.temperature_history: deque[float] = deque(maxlen=60)  # 60 –º–∏–Ω
        self.entropy_history: deque[float] = deque(maxlen=60)
        self.current_state: ThermodynamicState | None = None
        
    def update(self, market_state: MarketState) -> ThermodynamicState:
        """
        1. –í—ã—á–∏—Å–ª–∏—Ç—å T –∏–∑ –æ—Ä–¥–µ—Ä–±—É–∫–∞ –∏ —Å–¥–µ–ª–æ–∫
        2. –í—ã—á–∏—Å–ª–∏—Ç—å S –∏–∑ –æ—Ä–¥–µ—Ä–±—É–∫–∞
        3. –î–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é
        4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–∞–∑—É
        5. –í–µ—Ä–Ω—É—Ç—å ThermodynamicState
        """
```

2. –í `brain_loop` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å ThermodynamicState –≤ –ø—Ä–æ–º–ø—Ç Claude:
```
–§–ò–ó–ò–ö–ê –†–´–ù–ö–ê:
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {T} ({–æ–ø–∏—Å–∞–Ω–∏–µ: —Ö–æ–ª–æ–¥–Ω—ã–π/—Ç—ë–ø–ª—ã–π/–≥–æ—Ä—è—á–∏–π/–≤–∑—Ä—ã–≤})
- –≠–Ω—Ç—Ä–æ–ø–∏—è: {S} ({–æ–ø–∏—Å–∞–Ω–∏–µ: –ø–æ—Ä—è–¥–æ–∫/–±–∞–ª–∞–Ω—Å/—Ö–∞–æ—Å})
- –§–∞–∑–∞: {phase}
- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞: {prob}%
```

3. –í WebSocket broadcast ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è:
```json
{
    "type": "market_update",
    "data": {
        "price": 94247.50,
        "temperature": 847,
        "entropy": 0.34,
        "phase": "ice_to_water",
        "phase_change_prob": 0.72,
        ...
    }
}
```

---

# –§–ê–ó–ê 3: –†–ï–ù–¢–ì–ï–ù (–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤)

> **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–∑—ã:** AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ö–¢–û —Å—Ç–æ–∏—Ç –∑–∞ –∫–∞–∂–¥—ã–º –æ—Ä–¥–µ—Ä–æ–º. 
> iPhone –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–ú–ú –æ—Ö–æ—Ç–∏—Ç—Å—è –Ω–∞ —Å—Ç–æ–ø—ã", "–ò–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª –Ω–∞–±–∏—Ä–∞–µ—Ç —à–æ—Ä—Ç".

---

## –§–∞–∑–∞ 3, –®–∞–≥ 1: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å `server/xray/` ‚Äî –º–æ–¥—É–ª—å —Ä–µ–Ω—Ç–≥–µ–Ω–∞ —Ä—ã–Ω–∫–∞.

```
server/xray/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ classifier.py     # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ä–¥–µ—Ä–æ–≤ –ø–æ —Ç–∏–ø–∞–º
‚îú‚îÄ‚îÄ detector.py       # –î–µ—Ç–µ–∫—Ç–æ—Ä –∞–Ω–æ–º–∞–ª–∏–π (—Å—Ç–æ–ø-—Ö–∞–Ω—Ç, iceberg, —Å–ø—É—Ñ–∏–Ω–≥)
‚îî‚îÄ‚îÄ models.py         # Pydantic –º–æ–¥–µ–ª–∏
```

**–ú–æ–¥–µ–ª–∏:**
```python
class ParticipantType(str, Enum):
    MARKET_MAKER = "market_maker"
    INSTITUTIONAL = "institutional"
    RETAIL = "retail"
    BOT_ARBITRAGE = "bot_arbitrage"
    WHALE = "whale"

class ParticipantActivity(BaseModel):
    type: ParticipantType
    activity_level: float      # 0.0 - 1.0
    direction: str             # "buying", "selling", "neutral"
    description: str
    notable_actions: list[str] # –°–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

class XRaySnapshot(BaseModel):
    timestamp: datetime
    participants: list[ParticipantActivity]
    dominant_player: ParticipantType
    anomalies: list[str]        # –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏
    stop_hunt_detected: bool
    stop_hunt_direction: str | None
```

**–õ–æ–≥–∏–∫–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è, –±–µ–∑ ML):**

```python
def classify_participants(
    orderbook: OrderBookSnapshot,
    trades: list[Trade],         # –ø–æ—Å–ª–µ–¥–Ω–∏–µ 500 —Å–¥–µ–ª–æ–∫
    prev_orderbook: OrderBookSnapshot | None  # –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–Ω–∏–º–æ–∫
) -> XRaySnapshot:
    """
    –ú–ê–†–ö–ï–¢–ú–ï–ô–ö–ï–† –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
    - –°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ bid –∏ ask –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
    - –ß–∞—Å—Ç—ã–µ –æ—Ç–º–µ–Ω—ã/–ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å prev_orderbook: —É—Ä–æ–≤–Ω–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è/–∏—Å—á–µ–∑–∞—é—Ç)
    - –°–ø—É—Ñ–∏–Ω–≥: –∫—Ä—É–ø–Ω—ã–π –æ—Ä–¥–µ—Ä –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞–µ—Ç –∑–∞ <5 —Å–µ–∫
    
    –ò–ù–°–¢–ò–¢–£–¶–ò–û–ù–ê–õ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
    - –ö—Ä—É–ø–Ω—ã–µ –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ –æ–¥–Ω–æ–º-–¥–≤—É—Ö —É—Ä–æ–≤–Ω—è—Ö (>5 BTC –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ)
    - Iceberg: –º–Ω–æ–≥–æ —Å–¥–µ–ª–æ–∫ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (~0.1 BTC) –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ, –Ω–æ –æ—Ä–¥–µ—Ä –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
    - –£—Å—Ç–æ–π—á–∏–≤–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ: –¥–µ–ª—å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É –∑–∞ 15+ –º–∏–Ω—É—Ç
    
    –†–ò–¢–ï–ô–õ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
    - –ú–∞–ª–µ–Ω—å–∫–∏–µ –º–∞—Ä–∫–µ—Ç-–æ—Ä–¥–µ—Ä–∞ (<0.01 BTC)
    - –ö–ª–∞—Å—Ç–µ—Ä—ã —Å–¥–µ–ª–æ–∫ –Ω–∞ –∫—Ä—É–≥–ª—ã—Ö —á–∏—Å–ª–∞—Ö (93000, 94000, 95000)
    - –ü–æ–∫—É–ø–∫–∏ –ø–æ—Å–ª–µ —Ä–æ—Å—Ç–∞, –ø—Ä–æ–¥–∞–∂–∏ –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è (–ºomentum chasing)
    
    –ë–û–¢-–ê–†–ë–ò–¢–†–ê–ñ–ù–ò–ö:
    - –°–µ—Ä–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º <100–º—Å
    - –û–±—ä—ë–º—ã —Ä–æ–≤–Ω—ã–µ (0.100, 0.200)
    
    –ö–ò–¢:
    - –†–∞–∑–æ–≤–∞—è —Å–¥–µ–ª–∫–∞ > 5 BTC –º–∞—Ä–∫–µ—Ç-–æ—Ä–¥–µ—Ä–æ–º
    - –†–µ–∑–∫–∏–π —Å–¥–≤–∏–≥ —Ü–µ–Ω—ã > 0.1% –∑–∞ –æ–¥–Ω—É —Å–¥–µ–ª–∫—É
    
    –°–¢–û–ü-–•–ê–ù–¢:
    - –†–µ–∑–∫–∏–π –∏–º–ø—É–ª—å—Å –∫ –∫—Ä—É–≥–ª–æ–º—É —á–∏—Å–ª—É –Ω–∞ –Ω–∏–∑–∫–æ–º –æ–±—ä—ë–º–µ
    - –°—Ä–∞–∑—É –ø–æ—Å–ª–µ ‚Äî —Ä–∞–∑–≤–æ—Ä–æ—Ç
    - –°–µ—Ä–∏—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ
    """
```

---

## –§–∞–∑–∞ 3, –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–Ω—Ç–≥–µ–Ω–∞

–í `brain_loop` –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–º–ø—Ç Claude:
```
–†–ï–ù–¢–ì–ï–ù –£–ß–ê–°–¢–ù–ò–ö–û–í:
- –ú–∞—Ä–∫–µ—Ç–º–µ–π–∫–µ—Ä: {–æ–ø–∏—Å–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏}
- –ò–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª: {–æ–ø–∏—Å–∞–Ω–∏–µ}
- –†–∏—Ç–µ–π–ª: {–æ–ø–∏—Å–∞–Ω–∏–µ}
- –î–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π: {—Ç–∏–ø}
- –ê–Ω–æ–º–∞–ª–∏–∏: {—Å–ø–∏—Å–æ–∫}
- –°—Ç–æ–ø-—Ö–∞–Ω—Ç: {–¥–∞/–Ω–µ—Ç, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ}
```

–í WebSocket broadcast –¥–æ–±–∞–≤–∏—Ç—å:
```json
{
    "type": "xray_update",
    "data": {
        "participants": [...],
        "dominant_player": "institutional",
        "anomalies": ["–°—Ç–µ–Ω–∞ 340 BTC –Ω–∞ 95,200 —Å–Ω–∏–º–∞–µ—Ç—Å—è"],
        "stop_hunt_detected": true,
        "stop_hunt_direction": "up"
    }
}
```

---

# –§–ê–ó–ê 4: iPHONE APP (SwiftUI)

> **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–∑—ã:** –†–∞–±–æ—Ç–∞—é—â–µ–µ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ:
> 1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ WebSocket
> 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç Dashboard —Å —Ü–µ–Ω–æ–π, T, S, —Ñ–∞–∑–æ–π
> 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º—ã—à–ª–µ–Ω–∏–µ AI –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
> 4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ (–ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)
> 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–Ω—Ç–≥–µ–Ω —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

---

## –§–∞–∑–∞ 4, –®–∞–≥ 1: Xcode –ø—Ä–æ–µ–∫—Ç

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å iOS –ø—Ä–æ–µ–∫—Ç.

```
ios/HEAN/
‚îú‚îÄ‚îÄ HEANApp.swift
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ Network/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WebSocketManager.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ APIClient.swift
‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MarketState.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BrainAnalysis.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ThermodynamicState.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ XRaySnapshot.swift
‚îÇ   ‚îî‚îÄ‚îÄ Theme/
‚îÇ       ‚îú‚îÄ‚îÄ Colors.swift
‚îÇ       ‚îî‚îÄ‚îÄ Fonts.swift
‚îú‚îÄ‚îÄ Features/
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardView.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TemperatureGauge.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EntropyGauge.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SignalCard.swift
‚îÇ   ‚îú‚îÄ‚îÄ Brain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BrainView.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ThoughtBubble.swift
‚îÇ   ‚îú‚îÄ‚îÄ GravityMap/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GravityMapView.swift
‚îÇ   ‚îú‚îÄ‚îÄ Players/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PlayersView.swift
‚îÇ   ‚îî‚îÄ‚îÄ Settings/
‚îÇ       ‚îî‚îÄ‚îÄ SettingsView.swift
‚îî‚îÄ‚îÄ Resources/
    ‚îî‚îÄ‚îÄ Assets.xcassets
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞:**
- iOS 17.0+
- Swift 6
- Orientation: Portrait only
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (—Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω #0A0E27)

---

## –§–∞–∑–∞ 4, –®–∞–≥ 2: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Swift)

**–í—Å–µ –º–æ–¥–µ–ª–∏ ‚Äî Codable –¥–ª—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ JSON —Å —Å–µ—Ä–≤–µ—Ä–∞.**

```swift
// MarketState.swift
struct MarketUpdate: Codable {
    let price: Double
    let spread: Double
    let imbalance: Double
    let delta1m: Double
    let delta5m: Double
    let volume1m: Double
    let bigTradesCount: Int
    let bidTotal: Double
    let askTotal: Double
    let temperature: Double
    let entropy: Double
    let phase: String
    let phaseChangeProb: Double
}

// BrainAnalysis.swift  
struct BrainAnalysis: Codable {
    let situation: String
    let forces: [Force]
    let signal: TradingSignal
    let marketPhase: String
    let dangerLevel: Double
}

struct Force: Codable {
    let name: String
    let direction: String
    let strength: Double
    let description: String
}

struct TradingSignal: Codable {
    let direction: String  // LONG, SHORT, NO_TRADE
    let confidence: Double
    let entryPrice: Double?
    let stopLoss: Double?
    let takeProfit1: Double?
    let takeProfit2: Double?
    let riskReward: Double?
    let reasoning: String
}
```

---

## –§–∞–∑–∞ 4, –®–∞–≥ 3: WebSocket Manager

```swift
// WebSocketManager.swift
@Observable
class WebSocketManager {
    var isConnected = false
    var latestMarket: MarketUpdate?
    var latestBrain: BrainAnalysis?
    var latestXray: XRaySnapshot?
    var brainHistory: [BrainAnalysis] = []
    
    private var webSocket: URLSessionWebSocketTask?
    private let serverURL: URL
    
    init(serverURL: String = "ws://YOUR_SERVER_IP:8000/ws") {
        self.serverURL = URL(string: serverURL)!
    }
    
    func connect() async {
        // 1. –°–æ–∑–¥–∞—Ç—å URLSessionWebSocketTask
        // 2. Resume
        // 3. –ù–∞—á–∞—Ç—å —Å–ª—É—à–∞—Ç—å –≤ —Ü–∏–∫–ª–µ
        // 4. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å
        // 5. –ü–æ –ø–æ–ª—é "type" —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å:
        //    "market_update" ‚Üí latestMarket
        //    "brain_analysis" ‚Üí latestBrain, –¥–æ–±–∞–≤–∏—Ç—å –≤ brainHistory
        //    "xray_update" ‚Üí latestXray
        // 6. –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ ‚Äî –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫
    }
    
    func disconnect() {
        // –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    }
}
```

---

## –§–∞–∑–∞ 4, –®–∞–≥ 4: Dashboard View

**–û–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞:**
- –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å: —Å–∏–º–≤–æ–ª + —Ü–µ–Ω–∞ (–∫—Ä—É–ø–Ω–æ) + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –°–µ—Ä–µ–¥–∏–Ω–∞: –¥–≤–∞ –∫—Ä—É–≥–æ–≤—ã—Ö gauge ‚Äî –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –≠–Ω—Ç—Ä–æ–ø–∏—è
- –ü–æ–¥ –Ω–∏–º–∏: —Ñ–∞–∑–∞ —Ä—ã–Ω–∫–∞ (—Ç–µ–∫—Å—Ç–æ–º + —Ü–≤–µ—Ç)
- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–∏–≥–Ω–∞–ª–∞: –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –≤—Ö–æ–¥, —Å—Ç–æ–ø, TP, R:R, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
- –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å: P&L —Å–µ–≥–æ–¥–Ω—è (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ç–æ—Ä–≥–æ–≤–ª—è)
- Tab bar: Dashboard, Brain, Map, Players, Settings

**–¶–≤–µ—Ç–∞:**
- –§–æ–Ω: #0A0E27 (—Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π)
- Accent: #00D4FF (cyan)
- Danger: #FF3B5C (–∫—Ä–∞—Å–Ω—ã–π)
- Success: #00FF88 (–∑–µ–ª—ë–Ω—ã–π)
- Warm: #FF9500 (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- T gauge: –≥—Ä–∞–¥–∏–µ–Ω—Ç –æ—Ç —Å–∏–Ω–µ–≥–æ (—Ö–æ–ª–æ–¥–Ω—ã–π) –¥–æ –∫—Ä–∞—Å–Ω–æ–≥–æ (–≥–æ—Ä—è—á–∏–π)
- S gauge: –≥—Ä–∞–¥–∏–µ–Ω—Ç –æ—Ç –∑–µ–ª—ë–Ω–æ–≥–æ (–ø–æ—Ä—è–¥–æ–∫) –¥–æ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ (—Ö–∞–æ—Å)

**–ò—Å–ø–æ–ª—å–∑—É–π Swift Charts** –¥–ª—è gauge –µ—Å–ª–∏ –ø–æ–¥—Ö–æ–¥–∏—Ç, –∏–ª–∏ Custom View —Å `Canvas` / `Path` –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–≥–æ gauge.

---

## –§–∞–∑–∞ 4, –®–∞–≥ 5: Brain View

**–û–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞:**
- –°–∫—Ä–æ–ª–ª—è—â–∞—è—Å—è –ª–µ–Ω—Ç–∞ "–º—ã—Å–ª–µ–π" AI ‚Äî –∫–∞–∫ —á–∞—Ç-–ª–æ–≥
- –ö–∞–∂–¥–∞—è –º—ã—Å–ª—å = –∫–∞—Ä—Ç–æ—á–∫–∞ —Å:
  - –í—Ä–µ–º—è
  - –¢–µ–∫—Å—Ç —Å–∏—Ç—É–∞—Ü–∏–∏
  - –°–ø–∏—Å–æ–∫ —Å–∏–ª (—Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π UP/DOWN)
  - –°–∏–≥–Ω–∞–ª (–µ—Å–ª–∏ –µ—Å—Ç—å)
  - –§–∞–∑–∞ –∏ —É—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ù–æ–≤—ã–µ –º—ã—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–≤–µ—Ä—Ö—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
- –ü—É–ª—å—Å–∏—Ä—É—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "AI –¥—É–º–∞–µ—Ç..." –º–µ–∂–¥—É –∞–Ω–∞–ª–∏–∑–∞–º–∏

---

## –§–∞–∑–∞ 4, –®–∞–≥ 6: Gravity Map View

**–û–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞:**
- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —à–∫–∞–ª–∞ —Ü–µ–Ω
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –±–∞—Ä—ã ‚Äî –æ–±—ä—ë–º –æ—Ä–¥–µ—Ä–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ
- –ó–µ–ª—ë–Ω—ã–µ –±–∞—Ä—ã (bid/–ø–æ–∫—É–ø–∫–∏) —Å–ª–µ–≤–∞
- –ö—Ä–∞—Å–Ω—ã–µ –±–∞—Ä—ã (ask/–ø—Ä–æ–¥–∞–∂–∏) —Å–ø—Ä–∞–≤–∞
- –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É
- –£—Ä–æ–≤–Ω–∏ —Å–∫–æ–ø–ª–µ–Ω–∏—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π ‚Äî –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã –∂—ë–ª—Ç—ã–º –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–º —Ü–≤–µ—Ç–æ–º
- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è "–ø—Ä–∏—Ç—è–∂–µ–Ω–∏–µ" —Ü–µ–Ω—ã

---

## –§–∞–∑–∞ 4, –®–∞–≥ 7: Players View

**–û–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞:**
- 5 –∫–∞—Ä—Ç–æ—á–µ–∫ (–æ–¥–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞)
- –ö–∞–∂–¥–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞: –∏–∫–æ–Ω–∫–∞ + –Ω–∞–∑–≤–∞–Ω–∏–µ + –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (progress bar) + –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ + –æ–ø–∏—Å–∞–Ω–∏–µ
- –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–∞ –∏ –ø–æ–¥—Å–≤–µ—á–µ–Ω–∞
- –°–µ–∫—Ü–∏—è "–ê–Ω–æ–º–∞–ª–∏–∏" –≤–Ω–∏–∑—É ‚Äî –∫—Ä–∞—Å–Ω—ã–µ –ø–ª–∞—à–∫–∏ —Å —Ç–µ–∫—Å—Ç–æ–º

---

# –§–ê–ó–ê 5: –ü–ï–†–í–ê–Ø –ö–†–û–í–¨ (Paper Trading)

> **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–∑—ã:** HEAN —Ç–æ—Ä–≥—É–µ—Ç –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏ —á–µ—Ä–µ–∑ Bybit Testnet.

---

## –§–∞–∑–∞ 5, –®–∞–≥ 1: –¢–æ—Ä–≥–æ–≤—ã–π –¥–≤–∏–∂–æ–∫

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å `server/trading/` ‚Äî –º–æ–¥—É–ª—å —Ç–æ—Ä–≥–æ–≤–ª–∏.

```
server/trading/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ engine.py         # –¢–æ—Ä–≥–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ (–æ—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é)
‚îú‚îÄ‚îÄ risk.py           # –ñ–µ–ª–µ–∑–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∏—Å–∫–∞
‚îú‚îÄ‚îÄ position.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–µ–π
‚îî‚îÄ‚îÄ models.py
```

**–ú–æ–¥–µ–ª–∏:**
```python
class Position(BaseModel):
    id: str
    symbol: str
    direction: Literal["LONG", "SHORT"]
    entry_price: float
    size: float
    leverage: int
    stop_loss: float
    take_profit_1: float
    take_profit_2: float | None
    opened_at: datetime
    status: Literal["open", "closed", "stopped"]
    pnl: float = 0.0
    close_reason: str | None = None

class RiskConfig(BaseModel):
    max_daily_loss_pct: float = 3.0      # -3% –∏ —Å—Ç–æ–ø –Ω–∞ —Å—É—Ç–∫–∏
    max_weekly_loss_pct: float = 7.0     # -7% –∏ —Å—Ç–æ–ø –¥–æ –ü–ù
    max_trade_loss_pct: float = 1.0      # -1% –Ω–∞ —Å–¥–µ–ª–∫—É
    max_consecutive_losses: int = 3       # 3 —Å—Ç–æ–ø–∞ ‚Üí –ø–∞—É–∑–∞ 2—á
    min_risk_reward: float = 2.0         # –ú–∏–Ω–∏–º—É–º R:R
    max_leverage: int = 20
    max_open_positions: int = 1          # –û–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è –∑–∞ —Ä–∞–∑
```

**Risk Manager:**
```python
class RiskManager:
    def __init__(self, config: RiskConfig, deposit: float):
        self.config = config
        self.deposit = deposit
        self.daily_pnl = 0.0
        self.weekly_pnl = 0.0
        self.consecutive_losses = 0
        self.paused_until: datetime | None = None
        
    def can_trade(self) -> tuple[bool, str]:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∂–µ–ª–µ–∑–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞. 
        –í–µ—Ä–Ω—É—Ç—å (–º–æ–∂–Ω–æ_–ª–∏_—Ç–æ—Ä–≥–æ–≤–∞—Ç—å, –ø—Ä–∏—á–∏–Ω–∞_–µ—Å–ª–∏_–Ω–µ—Ç)"""
        
    def calculate_position_size(self, entry: float, stop: float, leverage: int) -> float:
        """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
        risk_amount = deposit * max_trade_loss_pct / 100
        price_diff_pct = abs(entry - stop) / entry
        position_size = risk_amount / (price_diff_pct * entry)
        """
        
    def record_trade(self, pnl: float):
        """–ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–¥–µ–ª–∫–∏, –æ–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏"""
```

**Trading Engine:**
```python
class TradingEngine:
    def __init__(self, exchange, risk_manager: RiskManager):
        self.exchange = exchange  # ccxt async
        self.risk = risk_manager
        self.current_position: Position | None = None
        
    async def execute_signal(self, signal: TradingSignal) -> Position | None:
        """
        1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å risk.can_trade()
        2. –ï—Å–ª–∏ NO_TRADE ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
        3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
        4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å R:R >= min_risk_reward
        5. –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ exchange
        6. –ü–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–æ–ø-–ª–æ—Å—Å –∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç
        7. –í–µ—Ä–Ω—É—Ç—å Position
        """
        
    async def check_position(self, current_price: float):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é:
        - –°—Ç–æ–ø —Å—Ä–∞–±–æ—Ç–∞–ª?
        - TP1 –¥–æ—Å—Ç–∏–≥–Ω—É—Ç? ‚Üí –∑–∞–∫—Ä—ã—Ç—å 30%, –ø–µ—Ä–µ–¥–≤–∏–Ω—É—Ç—å —Å—Ç–æ–ø –Ω–∞ –±–µ–∑—É–±—ã—Ç–æ–∫
        - TP2 –¥–æ—Å—Ç–∏–≥–Ω—É—Ç? ‚Üí –∑–∞–∫—Ä—ã—Ç—å –µ—â—ë 30%
        - –¢—Ä–µ–π–ª –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è 40%
        """
```

## –§–∞–∑–∞ 5, –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Bybit Testnet

```python
# Bybit Testnet –¥–ª—è paper trading
exchange = ccxt.bybit({
    'apiKey': settings.bybit_api_key,
    'secret': settings.bybit_api_secret,
    'options': {'defaultType': 'linear'},
    'sandbox': True  # ‚Üê –¢–ï–°–¢–ù–ï–¢
})
```

**–í–ê–ñ–ù–û:** –°–Ω–∞—á–∞–ª–∞ –¢–û–õ–¨–ö–û testnet. –†–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ ‚Äî –ø–æ—Å–ª–µ –º–∏–Ω–∏–º—É–º 2 –Ω–µ–¥–µ–ª—å –ø—Ä–∏–±—ã–ª—å–Ω–æ–≥–æ paper trading.

---

# –§–ê–ó–ê 6: –î–ï–ú–û–ù (–¢–µ–º–ø–æ—Ä–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ + –ú–µ—Ç–∞-–∏–≥—Ä–∞)

> **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–∑—ã:** AI –≤–∏–¥–∏—Ç 5 —É—Ä–æ–≤–Ω–µ–π –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ–π –∫–∞—Ä—Ç–∏–Ω—ã.

## –§–∞–∑–∞ 6, –®–∞–≥ 1: –¢–µ–º–ø–æ—Ä–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫

**–ó–∞–¥–∞—á–∞:** `server/demon/temporal.py`

```python
class TemporalLevel(BaseModel):
    name: str
    timeframe: str
    trend: Literal["bullish", "bearish", "neutral"]
    strength: float
    key_levels: list[float]
    description: str

class TemporalStack(BaseModel):
    macro: TemporalLevel    # –¥–Ω–∏-–Ω–µ–¥–µ–ª–∏
    session: TemporalLevel  # —á–∞—Å—ã
    tactical: TemporalLevel # –º–∏–Ω—É—Ç—ã
    execution: TemporalLevel # —Å–µ–∫—É–Ω–¥—ã
    micro: TemporalLevel    # –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
    
    alignment_score: float  # –Ω–∞—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã (0-1)
    # 1.0 = –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ = —Å–∏–ª—å–Ω–µ–π—à–∏–π —Å–∏–≥–Ω–∞–ª
```

## –§–∞–∑–∞ 6, –®–∞–≥ 2: –ú–µ–∂—Ä—ã–Ω–æ—á–Ω—ã–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏

**–ó–∞–¥–∞—á–∞:** `server/demon/cross_market.py`

–ü–æ–¥–∫–ª—é—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π WebSocket –∫ Binance –¥–ª—è ETH:
```python
# –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É BTC –∏ ETH
# BTC –¥–≤–∏–≥–∞–µ—Ç—Å—è ‚Üí —á–µ—Ä–µ–∑ N –º—Å ‚Üí ETH –¥–≤–∏–≥–∞–µ—Ç—Å—è
# –ï—Å–ª–∏ –∑–Ω–∞–µ–º N, –º–æ–∂–µ–º –≤–æ–π—Ç–∏ –≤ ETH –î–û –¥–≤–∏–∂–µ–Ω–∏—è

class CrossMarketAnalyzer:
    def __init__(self):
        self.btc_moves: deque = deque(maxlen=1000)
        self.eth_moves: deque = deque(maxlen=1000)
        self.lag_history: deque[float] = deque(maxlen=100)
        
    def record_move(self, symbol: str, price_change: float, timestamp: float):
        """–ó–∞–ø–∏—Å–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ"""
        
    def estimate_lag(self) -> float | None:
        """–û—Ü–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –∑–∞–¥–µ—Ä–∂–∫—É BTC ‚Üí ETH –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö"""
        
    def predict_eth_move(self, btc_move: float) -> tuple[float, float]:
        """–ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ ETH –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è BTC.
        –í–µ—Ä–Ω—É—Ç—å (expected_move, confidence)"""
```

---

# –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –≠–¢–û–¢ –î–û–ö–£–ú–ï–ù–¢

## –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã

```
1. –û—Ç–∫—Ä–æ–π –Ω–æ–≤—ã–π —á–∞—Ç —Å Claude
2. –ü—Ä–∏–∫—Ä–µ–ø–∏ —ç—Ç–æ—Ç —Ñ–∞–π–ª
3. –°–∫–∞–∂–∏: "–ü—Ä–æ—á–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç. –ù–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π –∫–æ–¥ –¥–ª—è –§–∞–∑—ã 1, –®–∞–≥ 1."
4. Claude –¥–∞—Å—Ç —Ç–µ–±–µ —Ñ–∞–π–ª—ã ‚Äî —Å–∫–æ–ø–∏—Ä—É–π –∏—Ö –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
5. –°–∫–∞–∂–∏: "–¢–µ–ø–µ—Ä—å –®–∞–≥ 2" ‚Äî –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
6. –ö–æ–≥–¥–∞ –§–∞–∑–∞ 1 –≥–æ—Ç–æ–≤–∞ ‚Äî –∑–∞–ø—É—Å—Ç–∏, –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
7. –í–µ—Ä–Ω–∏—Å—å: "–§–∞–∑–∞ 2, –®–∞–≥ 1"
8. –ò —Ç–∞–∫ –¥–æ –∫–æ–Ω—Ü–∞

–ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
- –°–∫–æ–ø–∏—Ä—É–π –æ—à–∏–±–∫—É
- –í—Å—Ç–∞–≤—å –≤ —á–∞—Ç
- Claude –ø–æ—á–∏–Ω–∏—Ç

–ï–°–õ–ò –•–û–ß–ï–®–¨ –ò–ó–ú–ï–ù–ò–¢–¨ –ß–¢–û-–¢–û:
- –û–ø–∏—à–∏ —á—Ç–æ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å
- Claude –ø–µ—Ä–µ–¥–µ–ª–∞–µ—Ç
```

## –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã

```
‚òê –§–ê–ó–ê 1: –ì–ª–∞–∑–∞ + –ú–æ–∑–≥
  ‚òê –®–∞–≥ 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞
  ‚òê –®–∞–≥ 2: config.py —Ä–∞–±–æ—Ç–∞–µ—Ç, .env —á–∏—Ç–∞–µ—Ç—Å—è
  ‚òê –®–∞–≥ 3: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã
  ‚òê –®–∞–≥ 4: Bybit WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –∏–¥—É—Ç
  ‚òê –®–∞–≥ 5: DuckDB —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
  ‚òê –®–∞–≥ 6: Claude –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
  ‚òê –®–∞–≥ 7: WebSocket –¥–ª—è iPhone —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚òê –®–∞–≥ 8: REST API –æ—Ç–≤–µ—á–∞–µ—Ç
  ‚òê –®–∞–≥ 9: main.py –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –≤—Å—ë –≤–º–µ—Å—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚òê –®–∞–≥ 10: –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

‚òê –§–ê–ó–ê 2: –§–∏–∑–∏–∫–∞
  ‚òê –®–∞–≥ 1: T, S, —Ñ–∞–∑—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è
  ‚òê –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–µ—Ä–≤–µ—Ä –∏ WebSocket

‚òê –§–ê–ó–ê 3: –†–µ–Ω—Ç–≥–µ–Ω
  ‚òê –®–∞–≥ 1: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚òê –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–µ—Ä–≤–µ—Ä

‚òê –§–ê–ó–ê 4: iPhone App
  ‚òê –®–∞–≥ 1: Xcode –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω
  ‚òê –®–∞–≥ 2: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö Swift
  ‚òê –®–∞–≥ 3: WebSocket Manager –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
  ‚òê –®–∞–≥ 4: Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
  ‚òê –®–∞–≥ 5: Brain View —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚òê –®–∞–≥ 6: Gravity Map –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ä–¥–µ—Ä–±—É–∫
  ‚òê –®–∞–≥ 7: Players View –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

‚òê –§–ê–ó–ê 5: Paper Trading
  ‚òê –®–∞–≥ 1: –¢–æ—Ä–≥–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ + Risk Manager
  ‚òê –®–∞–≥ 2: Bybit Testnet –ø–æ–¥–∫–ª—é—á—ë–Ω
  ‚òê 2 –Ω–µ–¥–µ–ª–∏ –ø—Ä–∏–±—ã–ª—å–Ω–æ–≥–æ paper trading ‚úì

‚òê –§–ê–ó–ê 6: –î–µ–º–æ–Ω
  ‚òê –®–∞–≥ 1: –¢–µ–º–ø–æ—Ä–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫
  ‚òê –®–∞–≥ 2: –ú–µ–∂—Ä—ã–Ω–æ—á–Ω—ã–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
```

---

*–î–æ–∫—É–º–µ–Ω—Ç: HEAN AI-Developer Blueprint v1.0 | –§–µ–≤—Ä–∞–ª—å 2026*
*–ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞. –ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è AI.*
