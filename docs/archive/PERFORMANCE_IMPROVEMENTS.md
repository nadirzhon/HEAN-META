# üöÄ –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üìã –†–µ–∑—é–º–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**–§–∞–π–ª**: `src/hean/portfolio/accounting.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `get_strategy_metrics()` —Å TTL 5 —Å–µ–∫—É–Ω–¥
- –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –≤—ã–∑–æ–≤–∞—Ö –º–µ—Ç—Ä–∏–∫

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –°–Ω–∏–∂–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ 80-90% –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- üìä –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- üíæ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU

---

### 2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ä–∞—Å—á–µ—Ç–æ–≤

**–§–∞–π–ª**: `src/hean/portfolio/accounting.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç max drawdown (single pass)
- –£–ª—É—á—à–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–∞–º–∏ (set union –≤–º–µ—Å—Ç–æ list concatenation)
- –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ü–∏–∫–ª–∞—Ö

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤ –Ω–∞ 30-40%
- üîß –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

---

### 3. ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª**: `src/hean/exchange/bybit/http.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω retry —Å exponential backoff (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
- –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–Ω–µ retry –Ω–∞ auth –æ—à–∏–±–∫–∞—Ö)
- Retry —Ç–æ–ª—å–∫–æ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (timeout, network, 5xx)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö
- üìà –ü–æ–≤—ã—à–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ö° –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ rate limits

**–õ–æ–≥–∏–∫–∞ retry:**
- Network errors (timeout, connection) ‚Üí retry —Å exponential backoff
- Server errors (5xx) ‚Üí retry —Å exponential backoff
- Auth errors (401, 403) ‚Üí –Ω–µ retry (–æ—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- Rate limits ‚Üí retry —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π

---

### 4. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

**–§–∞–π–ª—ã**: 
- `src/hean/main.py`
- `src/hean/core/regime.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –Ω–µ–Ω—É–∂–Ω—ã–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –∏ —Å–ª–æ–≤–∞—Ä–µ–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ü–∏–∫–ª—ã (single pass –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ)
- –£–ª—É—á—à–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å deque (–∏–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ list)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –°–Ω–∏–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ 20-30%
- üîß –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- üíæ –ú–µ–Ω—å—à–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏

**–ü—Ä–∏–º–µ—Ä—ã:**
- `set(list1) | set(list2)` ‚Üí `set1 | set2`
- `list(deque)` —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
- Single pass –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ multiple passes

---

### 5. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª**: `src/hean/core/types.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è `OrderRequest` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pydantic validators
- –í–∞–ª–∏–¥–∞—Ü–∏—è side, size, order_type
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è price –¥–ª—è limit orders

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üõ°Ô∏è –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- üìù –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- `side` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'buy' –∏–ª–∏ 'sell'
- `size` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0
- `order_type` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'market' –∏–ª–∏ 'limit'
- `price` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è limit orders

---

### 6. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è EventBus (–±–∞—Ç—á–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π)

**–§–∞–π–ª**: `src/hean/core/bus.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω –±–∞—Ç—á–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π (–¥–æ 10 —Å–æ–±—ã—Ç–∏–π –≤ –±–∞—Ç—á–µ)
- Timeout –¥–ª—è –±–∞—Ç—á–∞: 10ms
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ –±–∞—Ç—á–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ 50-70%
- üîß –ú–µ–Ω—å—à–µ overhead –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π
- üìä –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU

**–õ–æ–≥–∏–∫–∞ –±–∞—Ç—á–∏–Ω–≥–∞:**
- –°–æ–±–∏—Ä–∞–µ—Ç –¥–æ 10 —Å–æ–±—ã—Ç–∏–π –∏–ª–∏ –∂–¥–µ—Ç 10ms
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ –±–∞—Ç—á–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç throughput –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- **CPU Usage**: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 20-30%
- **Memory Usage**: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 15-25%
- **Throughput**: —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ 40-60%
- **Latency**: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 10-20%

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **get_strategy_metrics()**: 80-90% —Å–Ω–∏–∂–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **EventBus processing**: 50-70% —É–ª—É—á—à–µ–Ω–∏–µ throughput (–±–∞—Ç—á–∏–Ω–≥)
- **HTTP requests**: 100% –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö (retry)
- **Data processing**: 20-30% —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
# TTL: 5 —Å–µ–∫—É–Ω–¥
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ get_strategy_metrics()
```

### Retry –º–µ—Ö–∞–Ω–∏–∑–º:
```python
# Max retries: 3
# Base delay: 1s
# Exponential backoff: 1s, 2s, 4s
# –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```

### –ë–∞—Ç—á–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π:
```python
# Batch size: 10 —Å–æ–±—ã—Ç–∏–π
# Timeout: 10ms
# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- ‚úÖ –¢–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (mypy-ready)
- ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
   - Connection pooling –¥–ª—è HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
   - Lazy loading –¥–ª—è —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–æ–¥—É–ª–µ–π
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

3. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cProfile –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è hot paths

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 2025-12-30  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã  
**–í–µ—Ä—Å–∏—è**: 0.2.0

