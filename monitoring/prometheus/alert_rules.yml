groups:
  - name: hean-critical
    rules:
      - alert: APIDown
        expr: up{job="hean-api"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "HEAN API is down"
          description: "HEAN API has been unreachable for more than 2 minutes."

      - alert: KillswitchTriggered
        expr: hean_killswitch_triggered == 1
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "HEAN Killswitch triggered"
          description: "Trading has been halted by the killswitch."

      - alert: HighDrawdown
        expr: hean_drawdown_pct > 10
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High drawdown detected ({{ $value }}%)"
          description: "Drawdown exceeds 10% â€” approaching killswitch threshold (15%)."

  - name: hean-warning
    rules:
      - alert: NoTradesFor30m
        expr: increase(hean_fills_total[30m]) == 0 and up{job="hean-api"} == 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "No trades in 30 minutes"
          description: "System is running but no orders have been filled in 30 minutes."

      - alert: HighMemoryUsage
        expr: process_resident_memory_bytes{job="hean-api"} > 1.5e9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API memory usage high ({{ $value | humanize1024 }})"
          description: "API is using more than 1.5GB of memory."

      - alert: RedisMemoryHigh
        expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Redis memory usage above 80%"
          description: "Redis is using {{ $value | humanizePercentage }} of its max memory."

      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API error rate above 5%"
          description: "More than 5% of API requests are returning 5xx errors."
